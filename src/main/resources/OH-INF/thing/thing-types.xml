<?xml version="1.0" encoding="UTF-8"?>
<thing:thing-descriptions bindingId="traccar"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xmlns:thing="https://openhab.org/schemas/thing-description/v1.0.0"
	xsi:schemaLocation="https://openhab.org/schemas/thing-description/v1.0.0 https://openhab.org/schemas/thing-description-1.0.0.xsd">

	<!-- Traccar Server Bridge -->
	<bridge-type id="server">
		<label>Traccar Server</label>
		<description>Traccar GPS tracking server</description>

		<config-description>
			<parameter name="url" type="text" required="true">
				<context>url</context>
				<label>Server URL</label>
				<description>URL of the Traccar server (e.g., https://gps.agesen.dk)</description>
				<default>https://gps.agesen.dk</default>
			</parameter>
			<parameter name="username" type="text" required="true">
				<label>Username</label>
				<description>Traccar account username</description>
			</parameter>
			<parameter name="password" type="text" required="true">
				<context>password</context>
				<label>Password</label>
				<description>Traccar account password</description>
			</parameter>
			<parameter name="refreshInterval" type="integer" unit="s" min="10">
				<label>Refresh Interval</label>
				<description>Interval for polling device positions</description>
				<default>60</default>
				<advanced>true</advanced>
			</parameter>
			<parameter name="webhookPort" type="integer" min="1024" max="65535">
				<label>Webhook Port</label>
				<description>Port for receiving Traccar webhooks (geofence events)</description>
				<default>8090</default>
				<advanced>true</advanced>
			</parameter>
			<parameter name="speedUnit" type="text">
				<label>Speed Unit</label>
				<description>Unit for displaying speed (Traccar reports in knots)</description>
				<default>kmh</default>
				<options>
					<option value="kmh">Kilometers per Hour (km/h)</option>
					<option value="mph">Miles per Hour (mph)</option>
					<option value="knots">Knots</option>
				</options>
				<advanced>true</advanced>
			</parameter>
			<parameter name="speedThreshold" type="decimal" unit="kph" min="0" max="10" step="0.5">
				<label>Speed Threshold</label>
				<description>Minimum speed to display (filters GPS noise and small movements). Speeds below this are shown as 0.</description>
				<default>2.0</default>
				<advanced>true</advanced>
			</parameter>
			<parameter name="useNominatim" type="boolean">
				<label>Use Nominatim Geocoding</label>
				<description>Enable reverse geocoding using Nominatim instead of Traccar's address for all devices</description>
				<default>false</default>
				<advanced>true</advanced>
			</parameter>
			<parameter name="nominatimUrl" type="text">
				<context>url</context>
				<label>Nominatim Server URL</label>
				<description>URL of Nominatim server (default: OpenStreetMap public server)</description>
				<default>https://nominatim.openstreetmap.org</default>
				<advanced>true</advanced>
			</parameter>
			<parameter name="nominatimLanguage" type="text">
				<label>Address Language</label>
				<description>Language code for address results (e.g., en, da, de, fr)</description>
				<default>en</default>
				<limitToOptions>false</limitToOptions>
				<options>
					<option value="en">English</option>
					<option value="da">Danish</option>
					<option value="de">German</option>
					<option value="fr">French</option>
					<option value="es">Spanish</option>
				</options>
				<advanced>true</advanced>
			</parameter>
			<parameter name="geocodingCacheDistance" type="integer" unit="m" min="10" max="1000">
				<label>Cache Distance</label>
				<description>Minimum distance in meters to trigger new geocoding request (caches results within this radius)</description>
				<default>50</default>
				<advanced>true</advanced>
			</parameter>
		</config-description>
	</bridge-type>

	<!-- Traccar Device (Vehicle) -->
	<thing-type id="device">
		<supported-bridge-type-refs>
			<bridge-type-ref id="server"/>
		</supported-bridge-type-refs>

		<label>Traccar Device</label>
		<description>GPS tracked device/vehicle</description>

		<channels>
			<channel id="geofenceEvent" typeId="geofence-event"/>
			<channel id="geofenceId" typeId="geofence-id"/>
			<channel id="geofenceName" typeId="geofence-name"/>
			<channel id="position" typeId="position"/>
			<channel id="lastUpdate" typeId="last-update"/>
			<channel id="status" typeId="status"/>
			<channel id="speed" typeId="speed"/>
			<channel id="course" typeId="course"/>
			<channel id="accuracy" typeId="accuracy"/>
			<channel id="batteryLevel" typeId="battery-level"/>
			<channel id="odometer" typeId="odometer"/>
			<channel id="totalDistance" typeId="total-distance"/>
			<channel id="motion" typeId="motion"/>
			<channel id="address" typeId="address"/>
			<channel id="gpsSatellites" typeId="gps-satellites"/>
			<channel id="gsmSignal" typeId="gsm-signal"/>
			<channel id="hours" typeId="hours"/>
			<channel id="event" typeId="event"/>
			<channel id="altitude" typeId="altitude"/>
			<channel id="valid" typeId="valid"/>
			<channel id="distance" typeId="distance"/>
			<channel id="activity" typeId="activity"/>
			<channel id="protocol" typeId="protocol"/>
			<channel id="ignition" typeId="ignition"/>
			<!-- OBD-II Channels (Teltonika FMM920 with Bluetooth OBD-II dongle) -->
			<channel id="obdDtcCount" typeId="obd-dtc-count"/>
			<channel id="obdEngineLoad" typeId="obd-engine-load"/>
			<channel id="obdCoolantTemp" typeId="obd-coolant-temp"/>
			<channel id="obdShortFuelTrim" typeId="obd-short-fuel-trim"/>
			<channel id="obdFuelPressure" typeId="obd-fuel-pressure"/>
			<channel id="obdRpm" typeId="obd-rpm"/>
			<channel id="obdRpmReported" typeId="obd-rpm-reported"/>
			<channel id="obdSpeed" typeId="obd-speed"/>
			<channel id="obdFuelLevel" typeId="obd-fuel-level"/>
			<channel id="obdOemOdometer" typeId="obd-oem-odometer"/>
			<!-- Additional GPS/Teltonika Channels -->
			<channel id="pdop" typeId="pdop"/>
			<channel id="hdop" typeId="hdop"/>
			<channel id="power" typeId="power"/>
			<channel id="battery" typeId="battery"/>
			<channel id="operator" typeId="operator"/>
			<channel id="vin" typeId="vin"/>
			<!-- Experimental Teltonika IO Channels (unknown purpose) -->
			<channel id="io42" typeId="io42"/>
			<channel id="io49" typeId="io49"/>
			<channel id="io51" typeId="io51"/>
			<channel id="tripDistance" typeId="trip-distance"/>
			<channel id="eventCode" typeId="event-code"/>
			<!-- OBD-II Trip Meters from ECU -->
			<channel id="io199" typeId="io199"/>
			<channel id="io205" typeId="io205"/>
			<channel id="io389" typeId="io389"/>
		</channels>

		<properties>
			<property name="deviceId">Device ID</property>
			<property name="uniqueId">Unique ID</property>
			<property name="name">Device Name</property>
		</properties>

		<config-description>
			<parameter name="deviceId" type="integer" required="true">
				<label>Device ID</label>
				<description>Traccar device ID</description>
			</parameter>
		</config-description>
	</thing-type>

	<!-- Channel Types -->
	<channel-type id="geofence-event">
		<item-type>String</item-type>
		<label>Geofence Event</label>
		<description>Geofence entry/exit event (deviceEntered, deviceExited)</description>
		<state readOnly="true"/>
	</channel-type>

	<channel-type id="geofence-id">
		<item-type>Number</item-type>
		<label>Geofence ID</label>
		<description>ID of the geofence that triggered the event</description>
		<state readOnly="true"/>
	</channel-type>

	<channel-type id="geofence-name">
		<item-type>String</item-type>
		<label>Geofence Name</label>
		<description>Name of the geofence that triggered the event</description>
		<state readOnly="true"/>
	</channel-type>

	<channel-type id="position">
		<item-type>Location</item-type>
		<label>Position</label>
		<description>Current GPS position (latitude, longitude, altitude)</description>
		<state readOnly="true"/>
	</channel-type>

	<channel-type id="last-update">
		<item-type>DateTime</item-type>
		<label>Last Update</label>
		<description>Timestamp of last position update</description>
		<state readOnly="true"/>
	</channel-type>

	<channel-type id="status">
		<item-type>String</item-type>
		<label>Status</label>
		<description>Device online/offline status</description>
		<state readOnly="true">
			<options>
				<option value="online">Online</option>
				<option value="offline">Offline</option>
				<option value="unknown">Unknown</option>
			</options>
		</state>
	</channel-type>

	<channel-type id="speed">
		<item-type>Number:Speed</item-type>
		<label>Speed</label>
		<description>Current speed</description>
		<state readOnly="true" pattern="%.1f %unit%"/>
	</channel-type>

	<channel-type id="course">
		<item-type>Number:Angle</item-type>
		<label>Course</label>
		<description>Direction of travel in degrees (0-360)</description>
		<state readOnly="true" pattern="%.0f %unit%"/>
	</channel-type>

	<channel-type id="accuracy">
		<item-type>Number:Length</item-type>
		<label>Accuracy</label>
		<description>GPS position accuracy</description>
		<state readOnly="true" pattern="%.1f %unit%"/>
	</channel-type>

	<channel-type id="battery-level">
		<item-type>Number:Dimensionless</item-type>
		<label>Battery Level</label>
		<description>Device battery level</description>
		<state readOnly="true" pattern="%.0f %%"/>
	</channel-type>

	<channel-type id="odometer">
		<item-type>Number:Length</item-type>
		<label>Odometer</label>
		<description>Device odometer reading (OSMand protocol only)</description>
		<state readOnly="true" pattern="%.1f km"/>
	</channel-type>

	<channel-type id="total-distance">
		<item-type>Number:Length</item-type>
		<label>Total Distance</label>
		<description>Cumulative distance tracked by Traccar server (all protocols)</description>
		<state readOnly="true" pattern="%.1f km"/>
	</channel-type>

	<channel-type id="motion">
		<item-type>Switch</item-type>
		<label>Motion</label>
		<description>Motion detection status</description>
		<state readOnly="true"/>
	</channel-type>

	<channel-type id="address">
		<item-type>String</item-type>
		<label>Address</label>
		<description>Reverse geocoded address (if available)</description>
		<state readOnly="true"/>
	</channel-type>

	<channel-type id="gps-satellites">
		<item-type>Number</item-type>
		<label>GPS Satellites</label>
		<description>Number of GPS satellites used for positioning</description>
		<state readOnly="true" pattern="%d"/>
	</channel-type>

	<channel-type id="gsm-signal">
		<item-type>Number:Dimensionless</item-type>
		<label>GSM Signal Strength</label>
		<description>GSM/Cellular signal strength (RSSI)</description>
		<state readOnly="true" pattern="%.0f %%"/>
	</channel-type>

	<channel-type id="hours">
		<item-type>Number:Time</item-type>
		<label>Engine Hours</label>
		<description>Total engine running hours</description>
		<state readOnly="true" pattern="%.1f h"/>
	</channel-type>

	<channel-type id="event">
		<item-type>Number</item-type>
		<label>Event Code</label>
		<description>Device-specific event code</description>
		<state readOnly="true" pattern="%d"/>
	</channel-type>

	<channel-type id="altitude">
		<item-type>Number:Length</item-type>
		<label>Altitude</label>
		<description>Altitude/elevation above sea level</description>
		<state readOnly="true" pattern="%.1f m"/>
	</channel-type>

	<channel-type id="valid">
		<item-type>Switch</item-type>
		<label>GPS Valid</label>
		<description>GPS fix validity - ON when GPS has valid fix</description>
		<state readOnly="true"/>
	</channel-type>

	<channel-type id="distance">
		<item-type>Number:Length</item-type>
		<label>Distance</label>
		<description>Incremental distance since last position update</description>
		<state readOnly="true" pattern="%.1f m"/>
	</channel-type>

	<channel-type id="activity">
		<item-type>String</item-type>
		<label>Activity</label>
		<description>Detected activity type (walking, in_vehicle, still, etc.)</description>
		<state readOnly="true"/>
	</channel-type>

	<channel-type id="protocol">
		<item-type>String</item-type>
		<label>Protocol</label>
		<description>Device protocol/connection type</description>
		<state readOnly="true"/>
	</channel-type>

	<channel-type id="ignition">
		<item-type>Switch</item-type>
		<label>Ignition</label>
		<description>Ignition status (ON = ignition on, OFF = ignition off)</description>
		<state readOnly="true"/>
	</channel-type>

	<!-- OBD-II Channel Types (Teltonika FMM920 with Bluetooth OBD-II dongle) -->
	<channel-type id="obd-dtc-count">
		<item-type>Number</item-type>
		<label>OBD DTC Count</label>
		<description>Number of Diagnostic Trouble Codes (DTCs) - AVL ID 30</description>
		<state readOnly="true" pattern="%d codes"/>
	</channel-type>

	<channel-type id="obd-engine-load">
		<item-type>Number:Dimensionless</item-type>
		<label>OBD Engine Load</label>
		<description>Engine Load percentage - AVL ID 31</description>
		<state readOnly="true" pattern="%.1f %%"/>
	</channel-type>

	<channel-type id="obd-coolant-temp">
		<item-type>Number:Temperature</item-type>
		<label>OBD Coolant Temperature</label>
		<description>Engine Coolant Temperature - AVL ID 32</description>
		<state readOnly="true" pattern="%.1f %unit%"/>
	</channel-type>

	<channel-type id="obd-short-fuel-trim">
		<item-type>Number:Dimensionless</item-type>
		<label>OBD Short Fuel Trim</label>
		<description>Short Term Fuel Trim percentage - AVL ID 33</description>
		<state readOnly="true" pattern="%.1f %%"/>
	</channel-type>

	<channel-type id="obd-fuel-pressure">
		<item-type>Number:Pressure</item-type>
		<label>OBD Fuel Pressure</label>
		<description>Fuel Rail Pressure - AVL ID 35</description>
		<state readOnly="true" pattern="%.1f %unit%"/>
	</channel-type>

	<channel-type id="obd-rpm">
		<item-type>Number</item-type>
		<label>OBD RPM</label>
		<description>Engine RPM (from io36, actual RPM value) - AVL ID 36</description>
		<state readOnly="true" pattern="%d RPM"/>
	</channel-type>

	<channel-type id="obd-rpm-reported">
		<item-type>Number</item-type>
		<label>OBD RPM Reported</label>
		<description>Engine RPM from standard OBD-II PID (io37, often 0) - AVL ID 37</description>
		<state readOnly="true" pattern="%d RPM"/>
	</channel-type>

	<channel-type id="obd-speed">
		<item-type>Number:Speed</item-type>
		<label>OBD Speed</label>
		<description>Vehicle Speed from OBD-II - AVL ID 38</description>
		<state readOnly="true" pattern="%.1f %unit%"/>
	</channel-type>

	<channel-type id="obd-fuel-level">
		<item-type>Number:Dimensionless</item-type>
		<label>OBD Fuel Level</label>
		<description>Fuel Tank Level percentage - AVL ID 48</description>
		<state readOnly="true" pattern="%.1f %%"/>
	</channel-type>

	<channel-type id="obd-oem-odometer">
		<item-type>Number:Length</item-type>
		<label>OBD OEM Odometer</label>
		<description>Actual vehicle odometer reading from CAN bus via OBD-II (AVL ID 389). More accurate than totalDistance
			for vehicles with OBD-II dongles.</description>
		<state readOnly="true" pattern="%.1f %unit%"/>
	</channel-type>

	<!-- Additional GPS/Teltonika Channel Types -->
	<channel-type id="pdop">
		<item-type>Number</item-type>
		<label>PDOP</label>
		<description>Positional Dilution of Precision (3D GPS accuracy indicator, lower is better: 1-2=excellent, 2-5=good,
			>5=poor)</description>
		<state readOnly="true" pattern="%.1f"/>
	</channel-type>

	<channel-type id="hdop">
		<item-type>Number</item-type>
		<label>HDOP</label>
		<description>Horizontal Dilution of Precision (2D GPS accuracy indicator, lower is better: 1-2=excellent, 2-5=good,
			>5=poor)</description>
		<state readOnly="true" pattern="%.1f"/>
	</channel-type>

	<channel-type id="power">
		<item-type>Number:ElectricPotential</item-type>
		<label>Vehicle Power</label>
		<description>Vehicle battery voltage (12V/24V electrical system)</description>
		<state readOnly="true" pattern="%.2f %unit%"/>
	</channel-type>

	<channel-type id="battery">
		<item-type>Number:ElectricPotential</item-type>
		<label>Tracker Battery</label>
		<description>GPS tracker internal backup battery voltage</description>
		<state readOnly="true" pattern="%.2f %unit%"/>
	</channel-type>

	<channel-type id="operator">
		<item-type>String</item-type>
		<label>Mobile Operator</label>
		<description>Mobile network operator code (MCC+MNC)</description>
		<state readOnly="true" pattern="%s"/>
	</channel-type>

	<channel-type id="vin">
		<item-type>String</item-type>
		<label>VIN</label>
		<description>Vehicle Identification Number (from OBD-II or CAN bus)</description>
		<state readOnly="true" pattern="%s"/>
	</channel-type>

	<!-- Experimental Teltonika IO Channels (unknown purpose) -->
	<channel-type id="io42">
		<item-type>Number</item-type>
		<label>IO42</label>
		<description>Teltonika IO parameter 42 (varies 84-94, possibly intake air temperature or sensor)</description>
		<state readOnly="true" pattern="%d"/>
	</channel-type>

	<channel-type id="io49">
		<item-type>Number</item-type>
		<label>IO49</label>
		<description>Teltonika IO parameter 49 (typically ~5816, possibly battery voltage in mV)</description>
		<state readOnly="true" pattern="%d"/>
	</channel-type>

	<channel-type id="io51">
		<item-type>Number</item-type>
		<label>IO51</label>
		<description>Teltonika IO parameter 51 (varies 14000-14200, possibly alternator voltage in mV)</description>
		<state readOnly="true" pattern="%d"/>
	</channel-type>

	<channel-type id="trip-distance">
		<item-type>Number:Length</item-type>
		<label>Trip Distance</label>
		<description>Trip distance since last reset (meters)</description>
		<state readOnly="true" pattern="%.1f %unit%"/>
	</channel-type>

	<channel-type id="event-code">
		<item-type>Number</item-type>
		<label>Event Code</label>
		<description>Teltonika event code (e.g., 36 = OBD-II data update)</description>
		<state readOnly="true" pattern="%d"/>
	</channel-type>

	<!-- OBD-II Trip Meters from ECU -->
	<channel-type id="io199">
		<item-type>Number:Length</item-type>
		<label>Trip 1</label>
		<description>Trip odometer 1 from bike ECU - AVL ID 199</description>
		<state readOnly="true" pattern="%.1f %unit%"/>
	</channel-type>

	<channel-type id="io205">
		<item-type>Number:Length</item-type>
		<label>Trip 2</label>
		<description>Trip odometer 2 from bike ECU - AVL ID 205</description>
		<state readOnly="true" pattern="%.1f %unit%"/>
	</channel-type>

	<channel-type id="io389">
		<item-type>Number:Length</item-type>
		<label>Total ECU Mileage</label>
		<description>Total vehicle mileage from bike ECU - AVL ID 389</description>
		<state readOnly="true" pattern="%.1f %unit%"/>
	</channel-type>

</thing:thing-descriptions>
